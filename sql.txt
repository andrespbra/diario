
-- SCRIPT DE CRIAÇÃO DA TABELA DE ATIVOS
CREATE TABLE IF NOT EXISTS public.assets (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    term_id TEXT,
    produto TEXT,
    hostname TEXT UNIQUE,
    serial_number TEXT,
    equip_tipo_2 TEXT,
    filial TEXT,
    cod_site TEXT,
    location_name TEXT,
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Habilitar RLS
ALTER TABLE public.assets ENABLE ROW LEVEL SECURITY;

-- Políticas
DROP POLICY IF EXISTS "assets_select_policy" ON public.assets;
DROP POLICY IF EXISTS "assets_insert_policy" ON public.assets;
DROP POLICY IF EXISTS "assets_update_policy" ON public.assets;

CREATE POLICY "assets_select_policy" ON public.assets FOR SELECT TO authenticated USING (true);
CREATE POLICY "assets_insert_policy" ON public.assets FOR INSERT TO authenticated WITH CHECK (true);
CREATE POLICY "assets_update_policy" ON public.assets FOR UPDATE TO authenticated USING (true);

-- Permissões
GRANT ALL ON TABLE public.assets TO authenticated;
GRANT ALL ON TABLE public.assets TO service_role;

-- Atualizar Tabela de Tickets para incluir colunas de ativos (Opcional, mas útil para denormalização)
ALTER TABLE public.tickets ADD COLUMN IF NOT EXISTS term_id TEXT;
ALTER TABLE public.tickets ADD COLUMN IF NOT EXISTS filial TEXT;
ALTER TABLE public.tickets ADD COLUMN IF NOT EXISTS cod_site TEXT;
ALTER TABLE public.tickets ADD COLUMN IF NOT EXISTS equip_tipo_2 TEXT;
ALTER TABLE public.tickets ADD COLUMN IF NOT EXISTS produto TEXT;
